# DDAR
Development for the **Discrete Data Analysis with R** web site

## Requirements ##

PHP 5.3.10 or greater (5.4+ preferred)

Web server (e.g. Apache/Nginx)

## Overview ##

This is a super-simple custom php/html framework. The routing uses
[AltoRouter](http://altorouter.com), a small but powerful routing class, and
[Bootstrap](http://getbootstrap.com/) as the basis for a responsive web site
that will scale seemlessly from desktop to mobile. At mobile widths, the nav
collapses into a drop down suitable for use on mobile devices.

## Installation ##

### .htaccess (Apache) ###

The project serves all paths to the root's index.php file. As such there is
an .htaccess file in the project root that sets up the rewriting.
The file should contain the following:

```
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule . index.php [L]
```

### .conf (Nginx) ###

Some special considerations need to be made for serving files from Nginx.
Please make sure your project's .conf file has the following location
directive:

For a project being served from the web root:

```
location / {
	try_files $uri /index.php;
}

```

For a project served from a sub-directory:

```
location /subdir {
	try_files $uri /subdir/index.php;
}
```

### Directory permissions ###

After installing the web site codebase, please make both the
`/scripts/bootstrap` and `/styles/bootstrap` directories writable by the web
server.

### Composer package dependencies ###

This project requires `composer` to set up project dependencies

[https://getcomposer.org/](https://getcomposer.org/)

#### To install composer: ####

```
curl -sS https://getcomposer.org/installer | php -- --filename=composer
```

`composer` is then executable (by php) in the current directory.

```
composer install
composer run-script compile
```

`run-script compile` copies Bootstrap files to `{styles,scripts}/bootstrap`.


On future project updates you should always run:

```
composer update
composer run-script compile
```
### Environment variables ###

You will need to create a `.env` file in the project's root directory with
the following environment variable:

```
BASEPATH="/"
```

If you are serving this project from a subdirectory of the website's root,
you can change the above to point to the location of the subdirectory from the
web root, i.e.

```
BASEPATH="/subdirectory"
```

**Important:** Do not include a trailing slash if you are declaring a sub directory.

**Note:** If you are serving images in .html files, you will need to manually update
their paths to be relative to the sub directory.

## Site Map ##

This site is made up of the following initial files:

```
- index.php
- images/
- pages/
	- authors.html
	- book.html
	- home.html
	- materials.html
	- chapters/
		- ch01.html
		- ch01/
- scripts/
- src/
- styles/
```

## Explanation of files ##

`index.php` is the main framework entry point. Think of this as a very basic
controller in the model-view-controller pattern. index.php handles the setup of
the html document, including the navigation and dynamic inclusion of the pages
and chapters.

`images/` directory contains the global site images

`pages/` directory contains the main pages and the chapter pages. The direct
child pages  in this directory can be updated when needed. They are however
hard-coded into the nav in the index.php page. So adding any new pages will
require you to add them to the index.php navigation markup.

`pages/chapters/` directory contains the chapter files. This part of the
navigation is dynamically generated by the index.php file. When listing
chapters, the index.php script scans the 'pages/chapters/' directory and looks
for any files of the form (eg) `ch01.html` and then adds that to the chapter
list in the drop down menu.

`pages/chapters/ch01/` directory is where you would store all the images and
assets for the ch01.html file. Ideally you would keep assets for the chapters
contained in this way so that there would be a 'ch01.html' file and its
corresponding 'ch01/' directory where its assets would live.

`scripts/` directory contains the global site scripts

`src/` directory contains any php libraries or helper functions used in the
index.php page

`styles/` directory contains a 'main.css' file which is used for the global
styles. It also contains a 'page.css' file where you should put page-specific
css styles, and a 'chapters.css' file where you should put chapter-specific css
styles.

## Usage ##

### Main site entry point page ###

`index.php`

This page has been designed to set up the scaffolding for the site and
dynamically add nav items and page content.

**Note:** All static files in the index.php file, are served via a `urlfor` helper
function. If you plan on adding any files or pages, you will need to use this
helper as well.

### Chapter pages ###

`/pages/chapters/*.html`

The idea here is that you will continue to render the chapter files from
markdown using whatever process you have in place. The only caveat is that the
rendered .html files should ideally not contain `<html>`, `<head>`, or
`<body>` tags. They should only contain the markup inside the `<body>` tag.

You just need to add chapter pages to the `pages/chapters/` directory and the
site navigation will scale accordingly. Since the navigation looks to this
folder for files, it will build out all the Chapter sub pages in the navigation
automatically.

### Styles and Markup ###

You can change the markup of any of the pages to suit. Keep in mind that since
this site uses the Bookstrap framework, you should use Bootstrap markup and
classes whereever possible. Its not imperative that you do, but highly
suggested since using the Bootstrap styles will keep the content responsive.

See this link for details:
[http://getbootstrap.com/](http://getbootstrap.com/)
